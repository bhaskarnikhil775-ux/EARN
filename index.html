// --- 3. ðŸŒ REAL GOOGLE LOGIN (Redirect Method) ---
const handleGoogleLogin = async () => {
    setLoading(true);
    const provider = new firebase.auth.GoogleAuthProvider();
    const referrerId = getUrlReferrerId(); 

    try {
        // Pop-up ki jagah Redirect use kiya ja raha hai (Mobile-friendly)
        await auth.signInWithRedirect(provider);
        
        // NOTE: Redirect ke baad yeh code waapas yahan aayega
        
    } catch (error) {
        // Error handling for redirect
        console.error("Login failed:", error.message);
        setToast(error.code === 'auth/cancelled-popup-request' ? "Login cancelled." : "Login failed. Try again.");
        setLoading(false);
    }
};

// Redirect ke baad, app ko result check karna hoga
useEffect(() => {
    auth.getRedirectResult().then(async (result) => {
        if (result.user) {
            const user = result.user;
            const isNewUser = result.additionalUserInfo.isNewUser;
            
            // Call the secure Cloud Function for user initialization and referrer bonus
            const initializeUser = functions.httpsCallable('initializeUser');

            const response = await initializeUser({
                uid: user.uid,
                email: user.email,
                name: user.displayName,
                isNewUser: isNewUser,
                referrerId: isNewUser ? getUrlReferrerId() : null 
            });

            setUser(response.data.user);
            if (isNewUser) showToast("Signup successful! 50 Coins Bonus Added.");
        }
    }).catch((error) => {
        console.error("Redirect Error:", error);
    }).finally(() => {
        setLoading(false);
    });
}, []);

// Baaki sab components waise hi rahenge.
